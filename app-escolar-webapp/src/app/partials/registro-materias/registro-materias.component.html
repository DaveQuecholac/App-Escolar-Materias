<div class="wrapper">
  <div class="section-registro">
    <!-- Recuadro del título -->
    <mat-card class="title-card">
      <mat-card-header class="title-card-header">
        <div class="actions-header-colum">
          <ng-container *ngIf="!editar; else active">
            <mat-card-title class="title-card-text">Registro de materia</mat-card-title>
            <mat-card-subtitle class="subtitle-card-text">
              Agregar una nueva materia al sistema
            </mat-card-subtitle>
          </ng-container>
          <ng-template #active>
            <mat-card-title class="title-card-text">Edición de materia</mat-card-title>
            <mat-card-subtitle class="subtitle-card-text">
              Modifica los datos de la materia seleccionada
            </mat-card-subtitle>
          </ng-template>
        </div>
      </mat-card-header>
    </mat-card>

    <!-- Formulario de registro -->
    <div class="body-registro">
      <!-- NRC -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>NRC</mat-label>
        <input matInput [(ngModel)]="materia.nrc" mask="000000" name="nrc" placeholder="Escribe el NRC (5-6 dígitos)" maxlength="6">
      </mat-form-field>
      <div *ngIf="errors.nrc" class="invalid-feedback">{{ errors.nrc }}</div>

      <!-- Nombre de la materia -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Nombre de la materia</mat-label>
        <input matInput [(ngModel)]="materia.nombre_materia" (keypress)="soloLetras($event)" placeholder="Escribe el nombre de la materia">
      </mat-form-field>
      <div *ngIf="errors.nombre_materia" class="invalid-feedback">{{ errors.nombre_materia }}</div>

      <!-- Sección -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Sección</mat-label>
        <input matInput [(ngModel)]="materia.seccion" mask="000" name="seccion" placeholder="Escribe la sección" maxlength="3">
      </mat-form-field>
      <div *ngIf="errors.seccion" class="invalid-feedback">{{ errors.seccion }}</div>

      <!-- Días de la semana -->
      <div class="select-materias">
        <div class="row mt-3 mb-3">
          <div class="form-group col-12">
            <label class="title-materias" for="dias">Selecciona los días de la semana</label>
          </div>
        </div>
        <div class="checkbox-group" *ngFor="let dia of dias_semana; let i = index">
          <mat-checkbox class="checkbox-item opc-sc" name="dias" (change)="checkboxChange($event)" value="{{dia.value}}" [checked]="revisarSeleccion(dia.value)">
            <div class="d-checkbox-nombre">{{dia.nombre}}</div>
          </mat-checkbox>
        </div>
        <div *ngIf="errors.dias_semana" class="invalid-feedback">{{ errors.dias_semana }}</div>
      </div>

      <!-- Hora inicio -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Hora de inicio</mat-label>
        <input matInput [ngxTimepicker]="timepickerInicio" [(ngModel)]="materia.hora_inicio" 
               placeholder="Hora de inicio" readonly>
        <ngx-material-timepicker-toggle matSuffix [for]="timepickerInicio"></ngx-material-timepicker-toggle>
        <ngx-material-timepicker #timepickerInicio [format]="24" (timeSet)="changeHoraInicio($event)"></ngx-material-timepicker>
      </mat-form-field>
      <div *ngIf="errors.hora_inicio" class="invalid-feedback">{{ errors.hora_inicio }}</div>

      <!-- Hora fin -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Hora de finalización</mat-label>
        <input matInput [ngxTimepicker]="timepickerFin" [(ngModel)]="materia.hora_fin" 
               placeholder="Hora de finalización" readonly>
        <ngx-material-timepicker-toggle matSuffix [for]="timepickerFin"></ngx-material-timepicker-toggle>
        <ngx-material-timepicker #timepickerFin [format]="24" (timeSet)="changeHoraFin($event)"></ngx-material-timepicker>
      </mat-form-field>
      <div *ngIf="errors.hora_fin" class="invalid-feedback">{{ errors.hora_fin }}</div>

      <!-- Salón -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Salón</mat-label>
        <input matInput [(ngModel)]="materia.salon" (keypress)="soloAlfanumerico($event)" placeholder="Escribe el salón" maxlength="15">
      </mat-form-field>
      <div *ngIf="errors.salon" class="invalid-feedback">{{ errors.salon }}</div>

      <!-- Programa educativo -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Programa educativo</mat-label>
        <mat-select [(ngModel)]="materia.programa_educativo">
          <mat-option *ngFor="let programa of programas_educativos" [value]="programa.value">
            {{programa.nombre}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div *ngIf="errors.programa_educativo" class="invalid-feedback">{{ errors.programa_educativo }}</div>

      <!-- Profesor asignado -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Profesor asignado</mat-label>
        <mat-select [(ngModel)]="materia.profesor_asignado_id">
          <mat-option *ngFor="let maestro of lista_maestros" [value]="maestro.id">
            {{maestro.user.first_name}} {{maestro.user.last_name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div *ngIf="errors.profesor_asignado_id" class="invalid-feedback">{{ errors.profesor_asignado_id }}</div>

      <!-- Créditos -->
      <mat-form-field class="mat-input" appearance="outline">
        <mat-label>Créditos</mat-label>
        <input matInput [(ngModel)]="materia.creditos" mask="00" name="creditos" placeholder="Escribe los créditos" maxlength="2">
      </mat-form-field>
      <div *ngIf="errors.creditos" class="invalid-feedback">{{ errors.creditos }}</div>

      <div class="section-buttons">
        <button class="btn btn-danger" (click)="regresar()">Cancelar</button>
        <button *ngIf="!editar" class="btn btn-primary" type="submit" (click)="registrar()">Registrar</button>
        <button *ngIf="editar" class="btn btn-primary" type="submit" (click)="actualizar()">Actualizar</button>
      </div>
    </div>
  </div>
</div>

